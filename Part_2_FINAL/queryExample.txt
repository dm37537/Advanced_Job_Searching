Ilsun Lee(il2255)
Meng Da (dm3040)

/* 
Query 1. Find the users who satisfy job requirements for a specific job
This is an example of query which returns the user who satisfy GPA, degree and skills requirement of a specific job-posting.
I have used the first job post by the google_IT user to find users who have the resume which fulfills job requirement.
*/

SELECT R.userID 
FROM Resume_Post R
WHERE R.gpa >= (SELECT J.requiredGPA 
				FROM Job_Post J
				WHERE J.userID = 'google_IT' AND J.jobID = '1')
INTERSECT
(
	SELECT R.userID 
	FROM Resume_Post R
	WHERE (R.degree = 'Bachelor' OR R.degree = 'Doctorate' OR R.degree = 'Master') AND EXISTS 
				     (SELECT J.requiredDegree 
					  FROM Job_Post J
					  WHERE J.userID = 'google_IT' AND J.jobID = '1' AND J.requiredDegree = 'Bachelor')
	UNION
	SELECT R.userID 
	FROM Resume_Post R
	WHERE (R.degree = 'Doctorate' OR R.degree = 'Master') AND EXISTS 
				     (SELECT J.requiredDegree 
					  FROM Job_Post J
					  WHERE J.userID = 'google_IT' AND J.jobID = '1' AND J.requiredDegree = 'Master')
	UNION
	SELECT R.userID 
	FROM Resume_Post R
	WHERE (R.degree = 'Doctorate') AND EXISTS 
				     (SELECT J.requiredDegree 
					  FROM Job_Post J
					  WHERE J.userID = 'google_IT' AND J.jobID = '1' AND J.requiredDegree = 'Doctorate')
)
INTERSECT
Select R.userID 
FROM Resume_Post R
WHERE NOT EXISTS(
	(SELECT JRS.skill_ID 
	 FROM Job_Post J, Job_Require_Skill JRS
	 WHERE J.userID = 'google_IT' AND J.jobID = '1' AND J.jobID = JRS.jobID AND J.userID = JRS.userID)
	 MINUS(
	 Select RHS.skill_ID
	 FROM Resume_Have_Skill RHS, Job_Require_Skill JRS
	 WHERE RHS.resumeID = R.resumeID AND RHS.userID = R.userID AND JRS.userID = 'google_IT' AND JRS.jobID = '1'
	 	AND JRS.skill_ID = RHS.skill_ID AND JRS.knowledgeLevel <= RHS.knowledgeLevel));

/* 
QUERY 2. Find job-postings which can be satisfied by specific resume's GPA, degree and skills
This is an example of query which returns the list of jobs where the end user has the resume which satisfies the job-posting.
I have used the first resume posted by user 'ilsun.lee'. The resume GPA, degree and skills were compared with posted job and 
returns the job which are satisfied by the given resume. 
*/

SELECT J.userID, J.jobTitle, J.jobID
FROM Job_Post J
WHERE J.requiredGPA <= (SELECT R.gpa
						FROM Resume_Post R
						WHERE R.userID = 'ilsun.lee' AND R.resumeID = '1')
INTERSECT
(
	SELECT J.userID, J.jobTitle, J.jobID
	FROM Job_Post J
	WHERE (J.requiredDegree = 'Bachelor') AND EXISTS (
		SELECT R.degree 
		FROM Resume_Post R
		WHERE R.userID = 'ilsun.lee' AND R.resumeID = '1' AND R.degree = 'Bachelor')
	UNION
	SELECT J.userID, J.jobTitle, J.jobID
	FROM Job_Post J
	WHERE (J.requiredDegree = 'Bachelor' OR J.requiredDegree = 'Master') AND EXISTS (
		SELECT R.degree 
		FROM Resume_Post R
		WHERE R.userID = 'ilsun.lee' AND R.resumeID = '1' AND R.degree = 'Master')
	UNION
	SELECT J.userID, J.jobTitle, J.jobID
	FROM Job_Post J
	WHERE (J.requiredDegree = 'Bachelor' OR J.requiredDegree = 'Master' OR J.requiredDegree = 'Doctorate') AND EXISTS (
		SELECT R.degree 
		FROM Resume_Post R
		WHERE R.userID = 'ilsun.lee' AND R.resumeID = '1' AND R.degree = 'Doctorate')
)
INTERSECT
Select J.userID, J.jobTitle, J.jobID
FROM Job_Post J
WHERE NOT EXISTS(
	(SELECT JRS.skill_ID 
	 FROM Job_Require_Skill JRS
	 WHERE JRS.jobID = J.jobID AND JRS.userID = J.userID)
	 MINUS(
	 Select RHS.skill_ID
	 FROM Resume_Have_Skill RHS, Job_Require_Skill JRS
	 WHERE RHS.userID = 'ilsun.lee' AND RHS.resumeID = '1' AND JRS.jobID = J.jobID  AND JRS.userID = J.userID 
	 	AND JRS.skill_ID = RHS.skill_ID AND JRS.knowledgeLevel <= RHS.knowledgeLevel));

/*
QUERY 3. Find actual job applicant and check their reference and work experience.
For a given job, find job seeker who has actually applied to the job. 
Also check that they have prior work experience and reference. 
For reference, check that all of their rating are at least 7.
*/

(
	SELECT J.userID
	FROM JobSeeker_Apply_Job J
	WHERE J.job_post_userID = 'google_IT' AND J.jobID = '1'
)
INTERSECT
(
	SELECT J.userID
	FROM Job_Seeker J
	WHERE Exists(
		SELECT E.resumeID, E.experienceID
		FROM Resume_Have_WorkExperience E
		WHERE E.userID = J.userID 
		)
)
INTERSECT
(
	SELECT J.userID
	FROM Job_Seeker J
	WHERE Exists(
			SELECT R.userID, R.referenceID
			FROM Reference_Recommend R
			WHERE R.userID = J.userID
		) AND Not Exists(
			(SELECT R.userID, R.referenceID
			FROM Reference_Recommend R
			WHERE R.userID = J.userID)
			MINUS
			(SELECT R2.userID, R2.referenceID
			FROM Reference_Recommend R2
			WHERE R2.userID = J.userID AND R2.rating > 7)
		)
);


